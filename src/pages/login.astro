---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Iniciar Sesión Sistema Matrículas">
  <main class="flex items-center justify-center min-h-screen bg-gray-100">
    <div class="w-full max-w-md p-8 space-y-4 bg-white rounded-lg shadow-md">
      <h2 class="mt-6 text-3xl font-semibold text-left text-gray-900">
        Iniciar Sesión
      </h2>
      <p class="mt-2 text-left text-sm text-gray-600">
        Ingresa tus credenciales para acceder al sistema de matrículas.
      </p>
      <div class="flex justify-center">
        <img src="/public/logo.svg" alt="Logo" class="w-64 h-56" />
      </div>
      <form id="loginForm" class="mt-8 space-y-2">
        <div class="rounded-md shadow-sm my-12">
          <div>
            <label for="username" class="sr-only">Nombre de usuario</label>
            <input
              id="username"
              name="username"
              type="text"
              autocomplete="username"
              required
              class="relative block w-full px-3 py-2 my-2 text-gray-900 placeholder-gray-500 border border-gray-300 rounded-md appearance-none focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
              placeholder="Ingresa tu nombre de usuario"
            />
          </div>
          <div>
            <label for="password" class="sr-only">Contraseña</label>
            <input
              id="password"
              name="password"
              type="password"
              autocomplete="current-password"
              required
              class="relative block w-full px-3 py-2 my-2 text-gray-900 placeholder-gray-500 border border-gray-300 rounded-md appearance-none focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
              placeholder="Ingresa tu contraseña"
            />
          </div>
        </div>
        <div id="errorMessage" class="text-red-500 text-sm hidden"></div>
        <div>
          <button
            type="button"
            onclick="window.location.href='/recuperar-password'"
            class="relative flex justify-center w-full px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md group hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
          >
            Recuperar Contraseña
          </button>
        </div>
        <div>
          <button
            type="submit"
            class="relative flex justify-center w-full px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md group hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
          >
            Iniciar Sesión
          </button>
        </div>
        <div class="text-left">
          <a href="#" class="text-sm text-indigo-600 hover:text-indigo-500">
            Contactar con Soporte
          </a>
        </div>
      </form>
    </div>
  </main>
  <script type="module">
    /**
     * @param {Event} event
     */
    async function handleLogin(event) {
      event.preventDefault();
      const form = document.getElementById('loginForm');
      const formData = new FormData(form);
      const response = await fetch('/api/login', {
        method: 'POST',
        body: formData,
      });
      const result = await response.json();
      const errorMessage = document.getElementById('errorMessage');

      if (result.success) {
        window.location.href = '/dashboard'; // Redirige al usuario a la página de destino
      } else {
        errorMessage.textContent = result.message;
        errorMessage.classList.remove('hidden');
      }
    }

    document.getElementById('loginForm').addEventListener('submit', handleLogin);
  </script>
</Layout>
